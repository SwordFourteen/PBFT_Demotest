package main

import (
	"log"
	"os"
)

const clientAddr = "127.0.0.1:8888"
const nodeCount int = 80
const LoopNum = 20

var nodeTable map[string]string

func main() {
	genRsaKeys()
	nodeTable = map[string]string{
		"N0":  "127.0.0.1:8000",
		"N1":  "127.0.0.1:8001",
		"N2":  "127.0.0.1:8002",
		"N3":  "127.0.0.1:8003",
		"N4":  "127.0.0.1:8004",
		"N5":  "127.0.0.1:8005",
		"N6":  "127.0.0.1:8006",
		"N7":  "127.0.0.1:8007",
		"N8":  "127.0.0.1:8008",
		"N9":  "127.0.0.1:8009",
		"N10": "127.0.0.1:8010",
		"N11": "127.0.0.1:8011",
		"N12": "127.0.0.1:8012",
		"N13": "127.0.0.1:8013",
		"N14": "127.0.0.1:8014",
		"N15": "127.0.0.1:8015",
		"N16": "127.0.0.1:8016",
		"N17": "127.0.0.1:8017",
		"N18": "127.0.0.1:8018",
		"N19": "127.0.0.1:8019",
		"N20": "127.0.0.1:8020",
		"N21": "127.0.0.1:8021",
		"N22": "127.0.0.1:8022",
		"N23": "127.0.0.1:8023",
		"N24": "127.0.0.1:8024",
		"N25": "127.0.0.1:8025",
		"N26": "127.0.0.1:8026",
		"N27": "127.0.0.1:8027",
		"N28": "127.0.0.1:8028",
		"N29": "127.0.0.1:8029",
		"N30": "127.0.0.1:8030",
		"N31": "127.0.0.1:8031",
		"N32": "127.0.0.1:8032",
		"N33": "127.0.0.1:8033",
		"N34": "127.0.0.1:8034",
		"N35": "127.0.0.1:8035",
		"N36": "127.0.0.1:8036",
		"N37": "127.0.0.1:8037",
		"N38": "127.0.0.1:8038",
		"N39": "127.0.0.1:8039",
		"N40": "127.0.0.1:8040",
		"N41": "127.0.0.1:8041",
		"N42": "127.0.0.1:8042",
		"N43": "127.0.0.1:8043",
		"N44": "127.0.0.1:8044",
		"N45": "127.0.0.1:8045",
		"N46": "127.0.0.1:8046",
		"N47": "127.0.0.1:8047",
		"N48": "127.0.0.1:8048",
		"N49": "127.0.0.1:8049",
		"N50": "127.0.0.1:8050",
		"N51": "127.0.0.1:8051",
		"N52": "127.0.0.1:8052",
		"N53": "127.0.0.1:8053",
		"N54": "127.0.0.1:8054",
		"N55": "127.0.0.1:8055",
		"N56": "127.0.0.1:8056",
		"N57": "127.0.0.1:8057",
		"N58": "127.0.0.1:8058",
		"N59": "127.0.0.1:8059",
		"N60": "127.0.0.1:8060",
		"N61": "127.0.0.1:8061",
		"N62": "127.0.0.1:8062",
		"N63": "127.0.0.1:8063",
		"N64": "127.0.0.1:8064",
		"N65": "127.0.0.1:8065",
		"N66": "127.0.0.1:8066",
		"N67": "127.0.0.1:8067",
		"N68": "127.0.0.1:8068",
		"N69": "127.0.0.1:8069",
		"N70": "127.0.0.1:8070",
		"N71": "127.0.0.1:8071",
		"N72": "127.0.0.1:8072",
		"N73": "127.0.0.1:8073",
		"N74": "127.0.0.1:8074",
		"N75": "127.0.0.1:8075",
		"N76": "127.0.0.1:8076",
		"N77": "127.0.0.1:8077",
		"N78": "127.0.0.1:8078",
		"N79": "127.0.0.1:8079",
	}
	//stdReader := bufio.NewReader(os.Stdin) //监听输入区
	if len(os.Args) != 2 {
		log.Panic("输入的参数有误！")
	}
	nodeID := os.Args[1]
	if nodeID == "client" {
		clientSendMessageAndListen() //启动客户端程序
	} else if addr, ok := nodeTable[nodeID]; ok {
		p := NewPBFT(nodeID, addr)
		go p.tcpListen() //启动节点
	} else {
		log.Fatal("无此节点编号！")
	}

	select {}

}
